<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Biospace Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
html, body {
  margin: 0;
  padding: 0;
  font-family: 'Orbitron', sans-serif;
  height: 100%;
  overflow: hidden;
  background:
    linear-gradient(to bottom, rgba(0,0,0,0) 40%, #000 100%),
    url("background.png") no-repeat center center / cover;
  color: #fff;
}

/* App Bar */
.app-bar {
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 14px;
  background: rgba(0,0,0,0.6);
  border-bottom: 1px solid rgba(255,255,255,0.2);
  backdrop-filter: blur(12px);
  position: sticky;
  top: 0;
  z-index: 10;
}
.app-bar .btn {
  color: #fff; background: transparent; border: none;
  font-size: 1em; cursor: pointer; transition: .3s;
}
.app-bar .btn:hover { color: #00cfff; text-shadow: 0 0 8px #00cfff; }

/* Landing */
#landing { min-height: 100vh; position: relative; }

.team-title {
  position: absolute;
  top: 20%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 5em;
  font-weight: 900;
  text-align: center;
  color: #00cfff;
  letter-spacing: 4px;
  text-shadow: 0 0 15px #00cfff, 0 0 30px rgba(0,207,255,.7);
  animation: fadeInZoom 2s ease;
  z-index: 5;
}
@keyframes fadeInZoom {
  0% { opacity:0; transform: translate(-50%,-50%) scale(.6); }
  100% { opacity:1; transform: translate(-50%,-50%) scale(1); }
}

/* Role Selector */
/* Role Selector */
.role-selector {
  display: inline-flex;
  justify-content: center;
  margin-bottom: 50px;
  border: 1px solid #00cfff;
  border-radius: 12px;
  overflow: hidden; /* keeps buttons inside rounded frame */
  box-shadow: 0 0 15px rgba(0,207,255,.3);
}

.role-btn {
  flex: 1;
  background: rgba(0,0,0,0.4);
  color: #fff;
  font-family: 'Orbitron', sans-serif;
  font-size: 0.95em;
  padding: 10px 20px;
  border: none;
  border-right: 1px solid #00cfff;
  cursor: pointer;
  transition: all .3s ease;
}

.role-btn:last-child {
  border-right: none; /* remove divider from last button */
}

.role-btn:hover {
  background: rgba(0,207,255,.2);
  color: #00cfff;
  text-shadow: 0 0 8px #00cfff;
}

.role-btn.active {
  background: #00cfff;
  color: #000;
  font-weight: 900;
  text-shadow: none;
}

/* Search */
.search-section {
  position: absolute;
  bottom: 90px; left: 50%; transform: translateX(-50%);
  width: 95%; max-width: 450px; text-align: center; z-index: 3;
}
.suggestions {
  display: flex; flex-wrap: wrap; justify-content: center;
  gap: 8px; margin-bottom: 14px;
}
.suggestions .chip{
  background: rgba(255,255,255,.05);
  border: 1px solid #00cfff;
  padding: 6px 14px; border-radius: 20px; cursor: pointer;
  transition: .3s; color: #fff; font-size: .9em;
}
.suggestions .chip:hover { background: rgba(0,207,255,.3); transform: scale(1.08); }

.search-container{
  display: flex; justify-content: center; align-items: center;
  background: rgba(10,10,20,.85);
  border: 1px solid #00cfff; border-radius: 50px; padding: 6px 10px;
  box-shadow: 0 0 15px rgba(0,207,255,.4);
}
#search-input{
  padding: 12px; width: 75%; border: none; outline: none;
  background: transparent; color: #fff; font-size: 1em;
}
#search-input::placeholder{ color: rgba(255,255,255,.5); }
#search-btn{
  background: #00cfff; border: none; border-radius: 50%;
  width: 45px; height: 45px; font-size: 1.2em; cursor: pointer; margin-left: 6px;
  display: flex; align-items: center; justify-content: center;
  transition: transform .3s, box-shadow .3s;
}
#search-btn:hover{ transform: scale(1.08); box-shadow: 0 0 15px #00cfff; }

/* Rocket */
.rocket-container{ position: relative; width: 60px; margin: 18px auto 0; }
.rocket{
  width: 60px; height: 60px;
  background: url('https://upload.wikimedia.org/wikipedia/commons/e/e5/NASA_logo.svg') no-repeat center/contain;
}
.fire{
  position: absolute; bottom:-15px; left:50%;
  width:14px; height:30px; transform: translateX(-50%) rotate(45deg);
  background: linear-gradient(to top, orange, yellow);
  border-radius: 50%; animation: flame .5s infinite alternate;
}
@keyframes flame { 0%{height:20px;opacity:.7} 100%{height:35px;opacity:1} }

/* Results */
#results{
  background: #000; min-height: 100vh; padding: 60px 20px;
  margin-top: 15vh;
}
.results-header img{
  width: 70%; height: 10vh; object-fit: cover;
  border-radius: 12px; display: block; margin: 0 auto 20px auto;
}
.results-header .abstract{
  max-width: 800px; margin: 0 auto 40px; text-align: center;
  font-size: 1.1em; color: #ddd; line-height: 1.6em;
}

/* Timeline */
.timeline{
  position: relative; margin-left: 140px; padding-left: 20px;
  border-left: 4px solid orange;
}
.timeline-entry{ position: relative; margin: 40px 0; }
.timeline-entry::before{
  content: attr(data-year);
  position: absolute;
  left: -130px;
  top: 0;
  color: orange; font-size: 1.2em; font-weight: 800;
}
.timeline-card{
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(255,255,255,.2);
  border-radius: 10px; padding: 20px; max-width: 600px;
  box-shadow: 0 0 15px rgba(0,0,0,.5);
  cursor: pointer;
  transition: transform .2s;
}
.timeline-card:hover{
  transform: scale(1.02);
  box-shadow: 0 0 15px #00cfff;
}
.timeline-card h3{ margin-top: 0; color: #00cfff; }
.timeline-card p{ color: #ccc; }
.timeline-card .keywords {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.timeline-card .keywords span {
  background: rgba(0,207,255,.2); 
  color: #00cfff;
  padding: 5px 10px; 
  border-radius: 12px; 
  font-size: .85em;
  white-space: nowrap;
}
.timeline-card .role-summary {
  margin-top: 10px;
  font-size: 0.9em;
  color: #ffdd99;
  font-style: italic;
}
</style>
</head>
<body>

<!-- App Bar -->
<div class="app-bar">
  <button class="btn">👨 Humans</button>
  <button class="btn">🌱 Plants</button>
  <button class="btn">🦠 Microbes</button>
  <button class="btn">🔧 Equipment</button>
  <button class="btn">🧪 Experiments</button>
</div>

<!-- Landing -->
<section id="landing">
  <div class="team-title">BioSpace</div>
  <div class="search-section">
    <!-- ✅ Role Selector -->
    <div class="role-selector">
      <button class="role-btn active" data-role="scientists">Scientist</button>
      <button class="role-btn" data-role="managers">Manager</button>
      <button class="role-btn" data-role="mission_architects">Mission Architect</button>
    </div>
    <div class="suggestions">
      <span class="chip" data-topic="muscle">Muscles</span>
      <span class="chip" data-topic="roots">Roots</span>
      <span class="chip" data-topic="biofilm">Biofilm</span>
      <span class="chip" data-topic="simulator">Simulators</span>
      <span class="chip" data-topic="gene">Gene Analysis</span>
    </div>
    <div class="search-container">
      <input type="text" id="search-input" placeholder="Search bioscience…">
      <button id="search-btn">🚀</button>
    </div>
    <div class="rocket-container">
      <div class="rocket"></div>
    </div>
  </div>
</section>

<!-- Results -->
<section id="results">
  <div class="results-header">
    <div class="abstract" id="summary-text">
      Search results will appear below in chronological order.
    </div>
  </div>
  <div class="timeline" id="timeline"></div>
</section>

<script>
let dataset = [];
let selectedRole = "scientists"; // default role

// Load dataset
fetch("nasa_biospace_enriched.json")
  .then(r => r.json())
  .then(data => {
    dataset = Array.isArray(data) ? data : Object.values(data);
    console.log("✅ Dataset loaded:", dataset.length, "records");
  })
  .catch(err => console.error("❌ JSON Load Error:", err));

// --- Helper to safely get values regardless of key casing ---
function getVal(obj, keys, fallback = "") {
  for (let k of keys) {
    if (obj[k] !== undefined && obj[k] !== null) return obj[k];
  }
  return fallback;
}

function flattenObject(obj) {
  return Object.values(obj).map(v => {
    if (Array.isArray(v)) return v.join(" ");
    if (typeof v === "object" && v !== null) return flattenObject(v);
    return v;
  }).join(" ").toLowerCase();
}

/* ==================== SCROLL HELPERS ==================== */
function enableScroll() {
  document.documentElement.style.overflow = "auto";
  document.body.style.overflow = "auto";
}
function getScrollY() {
  return window.scrollY || document.documentElement.scrollTop || document.body.scrollTop || 0;
}
function setScrollY(y) {
  window.scrollTo(0, y);
  document.documentElement.scrollTop = y;
  document.body.scrollTop = y;
}
function autoScrollTo(targetY) {
  if (getScrollY() >= targetY) return;
  const STEP = 10, INTERVAL_MS = 10;
  const id = setInterval(() => {
    const cur = getScrollY(), next = cur + STEP;
    if (next >= targetY) {
      setScrollY(targetY);
      clearInterval(id);
      return;
    }
    setScrollY(next);
  }, INTERVAL_MS);
}
function scrollToResults() {
  const results = document.getElementById('results');
  const targetY = results.getBoundingClientRect().top + getScrollY();
  setTimeout(() => autoScrollTo(targetY), 20);
}

/* ==================== SEARCH ==================== */
function runSearch(query) {
  query = (query || "").toLowerCase().trim();
  console.log("🔎 Searching for:", query);

  if (!dataset.length) {
    alert("Dataset not loaded yet!");
    return;
  }

  const results = dataset.filter(p => flattenObject(p).includes(query));
  console.log("✅ Found:", results.length, "results");

  enableScroll();
  renderTimeline(results);
  setTimeout(scrollToResults, 50);
}

document.getElementById("search-btn").addEventListener("click", () => {
  const query = document.getElementById("search-input").value;
  runSearch(query);
});
document.getElementById("search-input").addEventListener("keydown", (e) => {
  if (e.key === "Enter") runSearch(e.target.value);
});
document.querySelectorAll(".chip").forEach(chip => {
  chip.addEventListener("click", () => {
    const topic = chip.dataset.topic || chip.textContent.trim();
    document.getElementById("search-input").value = topic;
    runSearch(topic);
  });
});

/* ==================== ROLE SELECTION ==================== */
document.querySelectorAll(".role-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".role-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    selectedRole = btn.dataset.role;
    console.log("🎯 Role selected:", selectedRole);
  });
});

/* ==================== RENDER RESULTS ==================== */
function renderTimeline(results) {
  const timeline = document.getElementById("timeline");
  timeline.innerHTML = "";

  if (!results.length) {
    timeline.innerHTML = "<p>No results found.</p>";
    return;
  }

  const sorted = results.sort((a, b) => {
    const yearA = getVal(a, ["Year","year","Date","date"], "0");
    const yearB = getVal(b, ["Year","year","Date","date"], "0");
    return parseInt(yearB) - parseInt(yearA);
  });

  sorted.forEach(paper => {
    const year = getVal(paper, ["Year","year","Date","date"], "Unknown");
    const title = getVal(paper, ["Title","title"], "Untitled");
    const abs = getVal(paper, ["Abstract","abstract"], "");
    const trimmedAbs = abs ? abs.substring(0, 300) + "..." : "";
    const keywords = getVal(paper, ["Keywords","keywords"], []);
    const keywordsHtml = Array.isArray(keywords) ? keywords.map(k => `<span>${k}</span>`).join("") : "";
    const url = getVal(paper, ["Link","link","URL","url"], "#");

    // ✅ Role-specific summary
    const roleSummary = getVal(paper, [
      "summary_" + selectedRole,
      "Summary_" + selectedRole
    ], "");

    const entry = document.createElement("div");
    entry.className = "timeline-entry";
    entry.setAttribute("data-year", year);

    entry.innerHTML = `
      <div class="timeline-card" data-url="${url}">
        <h3>${title}</h3>
        <p>${trimmedAbs}</p>
        ${roleSummary ? `<div class="role-summary">${roleSummary}</div>` : ""}
        <div class="keywords">${keywordsHtml}</div>
      </div>
    `;

    entry.querySelector(".timeline-card").addEventListener("click", () => {
      if (url && url !== "#") window.open(url, "_blank");
    });

    timeline.appendChild(entry);
  });
}
</script>
</body>
</html>
